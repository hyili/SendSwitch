<!DOCTYPE html>
<html lang="en">
<head>
    <title>Monitoring Page</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/socket.io/1.5.1/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
        var socket = io.connect("{{ url_for('monitor') }}");

        socket.on("connect", function() {
            socket.emit("connect_event", {data: " [*] Connected!"});
            socket.emit("client_event", {data: " [*] Ready for chat!"});
        });

        socket.on("disconnect", function() {
			var disconnect_msg = " [*] Disconnected.";
            $("#board").html(disconnect_msg);
            $("#log").append("<br>" + $("<div/>").text(disconnect_msg).html());
		});

        socket.on("server_response", function(msg) {
            $("#log").append("<br>" + $("<div/>").text(msg.data).html());
        });

        socket.on("server_statistic", function(msg) {
			var connect_msg = " [*] Connected.";
			$("#board").html(connect_msg + " <br> [*] " + msg.data + " emails total");
            for (i = 0; i < msg.log.length; i++) {
                $("#log").append("<br>" + $("<div/>").text(msg.log[i]).html());
            }
        });

        $("#emit").submit(function(event) {
            socket.emit("client_event", {data: " [*] "+$("#emit_data").val()});
            event.preventDefault();
        });
    });
    
    </script>
</head>

<body>
    <div class="container-fluid">
        <h4 class="display-4">Server Throughput</h4>
        <div id="board" class="w-100 p-3" style="background-color:#eee;font-family:Courier New;white-space: pre;"> [*] GOGOGO~</div>

        <h4 class="display-4">Echo Test & Log</h4>
        <form id="emit" method="POST" action="#">
            <div class="form-group">
                <input type="text" class="form-control" name="emit_data" id="emit_data" placeholder="Message">
            </div>
            <div class="form-group">
                <input type="submit" class="btn btn-primary" value="Echo">
            </div>
        </form>
        <div id="log" class="w-100 p-3" style="background-color:#eee;font-family:Courier New;white-space: pre;"> [*] GOGOGO~</div>
    </div>
</body>


</html>
